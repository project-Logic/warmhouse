## Уровни архитектуры

### 1. Уровень контейнеров (C4 Containers)

Диаграмма `c4-containers-diagram.puml` показывает основные сервисы и их взаимодействие:

- **API Gateway** - единая точка входа для всех внешних запросов
- **Heating Service** - сервис управления отоплением
- **Temperature Service** - сервис мониторинга температуры
- **Device Service** - сервис управления устройствами
- **Auth Service** - сервис аутентификации и авторизации
- **Kafka** - шина событий
- **PostgreSQL** - база данных

### 2. Уровень компонентов (C4 Components)

Диаграмма `c4-components-heating.puml` детализирует внутреннюю структуру микросервиса управления отоплением:

- **Heating API** - REST контроллер для внешних запросов
- **Command Handler** - обработчик команд управления
- **State Manager** - менеджер состояния систем отопления
- **Event Publisher** - публикатор событий в Kafka
- **Heating Repository** - слой доступа к данным

### 3. Уровень кода (C4 Code)

Диаграмма `c4-code-heating-command.puml` показывает детальную реализацию обработки команд:

- **HeatingCommand** - класс команды управления отоплением
- **CommandType** - перечисление типов команд
- **HeatingCommandHandler** - обработчик команд
- **HeatingStateManager** - менеджер состояния
- **EventPublisher** - публикатор событий
- **HeatingRepository** - репозиторий данных
- **HeatingState** - модель состояния
- **Event** - модель события

## Описание архитектуры в YAML

Файл `microservices-architecture.yaml` содержит полное описание архитектуры, включая:

1. **Сервисы**:
   - Тип (core, supporting, generic)
   - Технологии
   - Обязанности
   - Зависимости

2. **Инфраструктура**:
   - База данных (PostgreSQL)
   - Шина событий (Kafka)

3. **Взаимодействие**:
   - HTTP/REST для синхронных запросов
   - Event-Driven через Kafka
   - JDBC для доступа к данным

## Ключевые особенности архитектуры

1. **Разделение ответственности**:
   - Каждый сервис отвечает за свой домен
   - Четкие границы контекстов
   - Изолированные домены

2. **Событийная архитектура**:
   - Асинхронная коммуникация через Kafka
   - Событийное управление состоянием
   - Лучшая масштабируемость

3. **Безопасность**:
   - Централизованная аутентификация
   - Rate limiting на уровне API Gateway
   - Изолированный доступ к данным

4. **Масштабируемость**:
   - Независимое масштабирование сервисов
   - Горизонтальное масштабирование
   - Отказоустойчивость

## Преимущества новой архитектуры

1. **Гибкость**:
   - Независимое развертывание сервисов
   - Возможность использования разных технологий
   - Простота внедрения новых функций

2. **Масштабируемость**:
   - Возможность масштабировать отдельные сервисы
   - Лучшая производительность
   - Эффективное использование ресурсов

3. **Надежность**:
   - Изоляция отказов
   - Устойчивость к сбоям
   - Простота восстановления

4. **Поддерживаемость**:
   - Меньший размер кодовой базы
   - Четкие границы ответственности
   - Простота тестирования 